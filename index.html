<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced 5D Tile Visualizer</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/PointerLockControls.js"></script>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6c757d;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
        }
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        #app {
            display: flex;
            height: 100vh;
        }
        #toolbar {
            width: 60px;
            background: var(--dark-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
        }
        .tool-btn {
            width: 40px;
            height: 40px;
            margin-bottom: 15px;
            background: var(--secondary-color);
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .tool-btn.active {
            background: var(--primary-color);
        }
        .tool-btn:hover {
            transform: scale(1.1);
        }
        #sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        #sidebar-header {
            padding: 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }
        #sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        #viewer-container {
            flex: 1;
            position: relative;
        }
        #viewer {
            width: 100%;
            height: 100%;
        }
        #mode-switcher {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .mode-btn {
            padding: 8px 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 500;
        }
        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }
        #stats-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 200px;
        }
        .stat-item {
            margin-bottom: 8px;
        }
        .stat-label {
            font-size: 12px;
            color: var(--secondary-color);
        }
        .stat-value {
            font-weight: bold;
        }
        .material-thumb {
            width: 100%;
            height: 80px;
            background-size: cover;
            background-position: center;
            margin-bottom: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 4px;
        }
        .material-thumb.selected {
            border-color: var(--primary-color);
        }
        .material-item {
            margin-bottom: 15px;
        }
        .material-name {
            font-size: 14px;
            margin-bottom: 5px;
        }
        .section-title {
            font-weight: bold;
            margin: 15px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        #first-person-ui {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .top-bar-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .top-bar-btn:hover {
            background: #f0f0f0;
        }
        #room-dimensions {
            position: absolute;
            top: 60px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        .dimension-input {
            margin-bottom: 10px;
        }
        .dimension-input label {
            display: block;
            font-size: 12px;
            margin-bottom: 3px;
        }
        .dimension-input input {
            width: 100%;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="toolbar">
            <button class="tool-btn active" title="Select" id="btn-select">‚úèÔ∏è</button>
            <button class="tool-btn" title="Wall" id="btn-wall">üß±</button>
            <button class="tool-btn" title="Door" id="btn-door">üö™</button>
            <button class="tool-btn" title="Window" id="btn-window">ü™ü</button>
            <div style="flex: 1;"></div>
            <button class="tool-btn" title="Settings" id="btn-settings">‚öôÔ∏è</button>
        </div>
        
        <div id="sidebar">
            <div id="sidebar-header">Tile Materials</div>
            <div id="sidebar-content">
                <div class="section-title">Floor Tiles</div>
                <div class="material-item">
                    <div class="material-thumb selected" style="background-image: url('https://ik.imagekit.io/pziy0u4kb/tile%201.jpg?updatedAt=1753787882692');" data-texture="floor1"></div>
                    <div class="material-name">Crema Marfil</div>
                </div>
                <div class="material-item">
                    <div class="material-thumb" style="background-image: url('https://ik.imagekit.io/pziy0u4kb/tile%202.png?updatedAt=1753788299488');" data-texture="floor2"></div>
                    <div class="material-name">Slate Grey</div>
                </div>
                <div class="material-item">
                    <div class="material-thumb" style="background-image: url('https://ik.imagekit.io/pziy0u4kb/tile%203.webp?updatedAt=1753788450579');" data-texture="floor3"></div>
                    <div class="material-name">Carrara White</div>
                </div>
                
                <div class="section-title">Wall Tiles</div>
                <div class="material-item">
                    <div class="material-thumb" style="background-image: url('https://ik.imagekit.io/pziy0u4kb/tile%204.webp?updatedAt=1754055287618');" data-texture="wall1"></div>
                    <div class="material-name">Subway White</div>
                </div>
                <div class="material-item">
                    <div class="material-thumb" style="background-image: url('https://ik.imagekit.io/pziy0u4kb/tile%205.jpg?updatedAt=1754055435637');" data-texture="wall2"></div>
                    <div class="material-name">Mediterranean Blue</div>
                </div>
            </div>
        </div>
        
        <div id="viewer-container">
            <div class="top-bar">
                <div>
                    <button class="top-bar-btn" id="btn-dimensions">Room Dimensions</button>
                </div>
                <div>
                    <button class="top-bar-btn" id="btn-save">Save Project</button>
                    <button class="top-bar-btn" id="btn-share">Share</button>
                </div>
            </div>
            
            <div id="room-dimensions">
                <div class="dimension-input">
                    <label>Width (ft)</label>
                    <input type="number" id="room-width" value="12" min="5" max="50">
                </div>
                <div class="dimension-input">
                    <label>Depth (ft)</label>
                    <input type="number" id="room-depth" value="10" min="5" max="50">
                </div>
                <div class="dimension-input">
                    <label>Height (ft)</label>
                    <input type="number" id="room-height" value="8" min="5" max="20">
                </div>
                <button id="btn-update-room" style="width: 100%; padding: 8px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer;">Update Room</button>
            </div>
            
            <div id="viewer"></div>
            
            <div id="mode-switcher">
                <button class="mode-btn active" data-mode="2d">2D</button>
                <button class="mode-btn" data-mode="3d">3D</button>
                <button class="mode-btn" data-mode="fp">First Person</button>
            </div>
            
            <div id="stats-panel">
                <div class="stat-item">
                    <div class="stat-label">Floor Area</div>
                    <div class="stat-value" id="stat-floor">120 sq.ft</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Wall Area</div>
                    <div class="stat-value" id="stat-walls">352 sq.ft</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Tile Cost</div>
                    <div class="stat-value" id="stat-cost">$1,416.00</div>
                </div>
            </div>
            
            <div id="first-person-ui">
                WASD to move, SPACE to jump, ESC to exit
            </div>
        </div>
    </div>

    <script>
        // Main Application
        class TileVisualizer {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.fpControls = null;
                this.room = null;
                this.floor = null;
                this.walls = [];
                this.currentMode = '3d';
                this.currentTool = 'select';
                this.selectedMaterial = 'floor1';
                this.roomWidth = 12;
                this.roomDepth = 10;
                this.roomHeight = 8;
                this.tilePrice = 3.50;
                
                this.init();
                this.setupEventListeners();
                this.createRoom();
            }
            
            init() {
                // Initialize Three.js
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf0f0f0);
                
                // Camera
                this.camera = new THREE.PerspectiveCamera(60, (window.innerWidth - 360) / window.innerHeight, 0.1, 1000);
                this.camera.position.set(15, 15, 15);
                
                // Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth - 360, window.innerHeight);
                this.renderer.shadowMap.enabled = true;
                document.getElementById('viewer').appendChild(this.renderer.domElement);
                
                // Controls
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                
                // First-person controls (initially inactive)
                this.fpControls = new THREE.PointerLockControls(this.camera, document.body);
                
                // Lighting
                this.setupLighting();
                
                // Grid helper
                const gridHelper = new THREE.GridHelper(50, 50, 0x888888, 0xcccccc);
                this.scene.add(gridHelper);
                
                // Start animation loop
                this.animate();
            }
            
            setupLighting() {
                // Ambient light
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                // Directional light (sun)
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 20, 10);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);
                
                // Hemisphere light for natural illumination
                const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.2);
                hemisphereLight.position.set(0, 20, 0);
                this.scene.add(hemisphereLight);
            }
            
            setupEventListeners() {
                // Window resize
                window.addEventListener('resize', () => this.onWindowResize());
                
                // Tool buttons
                document.getElementById('btn-select').addEventListener('click', () => this.setTool('select'));
                document.getElementById('btn-wall').addEventListener('click', () => this.setTool('wall'));
                document.getElementById('btn-door').addEventListener('click', () => this.setTool('door'));
                document.getElementById('btn-window').addEventListener('click', () => this.setTool('window'));
                
                // Mode switcher
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.setMode(e.target.dataset.mode));
                });
                
                // Material selection
                document.querySelectorAll('.material-thumb').forEach(thumb => {
                    thumb.addEventListener('click', (e) => {
                        document.querySelectorAll('.material-thumb').forEach(t => t.classList.remove('selected'));
                        e.target.classList.add('selected');
                        this.selectedMaterial = e.target.dataset.texture;
                        this.applyMaterial();
                    });
                });
                
                // Room dimensions
                document.getElementById('btn-dimensions').addEventListener('click', () => {
                    const panel = document.getElementById('room-dimensions');
                    panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
                });
                
                document.getElementById('btn-update-room').addEventListener('click', () => {
                    this.roomWidth = parseFloat(document.getElementById('room-width').value);
                    this.roomDepth = parseFloat(document.getElementById('room-depth').value);
                    this.roomHeight = parseFloat(document.getElementById('room-height').value);
                    this.createRoom();
                    document.getElementById('room-dimensions').style.display = 'none';
                });
                
                // First-person controls
                document.addEventListener('keydown', (e) => {
                    if (this.currentMode !== 'fp') return;
                    
                    const moveSpeed = 0.2;
                    const jumpSpeed = 0.5;
                    
                    switch(e.key.toLowerCase()) {
                        case 'w':
                            this.fpControls.moveForward(moveSpeed);
                            break;
                        case 's':
                            this.fpControls.moveForward(-moveSpeed);
                            break;
                        case 'a':
                            this.fpControls.moveRight(-moveSpeed);
                            break;
                        case 'd':
                            this.fpControls.moveRight(moveSpeed);
                            break;
                        case ' ':
                            this.camera.position.y += jumpSpeed;
                            break;
                    }
                });
            }
            
            setTool(tool) {
                this.currentTool = tool;
                document.querySelectorAll('#toolbar .tool-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`btn-${tool}`).classList.add('active');
                
                // In a full implementation, we would change the cursor/behavior based on tool
            }
            
            setMode(mode) {
                this.currentMode = mode;
                document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.mode-btn[data-mode="${mode}"]`).classList.add('active');
                
                // Show/hide first-person UI
                document.getElementById('first-person-ui').style.display = mode === 'fp' ? 'block' : 'none';
                
                if (mode === 'fp') {
                    // Activate first-person controls
                    this.controls.enabled = false;
                    this.fpControls.lock();
                    
                    // Position camera at human height
                    this.camera.position.set(0, 1.7, 5);
                } else {
                    // Deactivate first-person controls
                    this.fpControls.unlock();
                    this.controls.enabled = true;
                    
                    if (mode === '2d') {
                        // Top-down view for 2D mode
                        this.camera.position.set(0, 20, 0);
                        this.camera.lookAt(0, 0, 0);
                    } else {
                        // Default 3D view
                        this.camera.position.set(15, 15, 15);
                    }
                }
            }
            
            createRoom() {
                // Clear previous room if exists
                if (this.room) {
                    this.scene.remove(this.room);
                    this.walls.forEach(wall => this.scene.remove(wall));
                    this.walls = [];
                }
                
                // Create room container
                this.room = new THREE.Group();
                
                // Create floor
                const floorGeometry = new THREE.PlaneGeometry(this.roomWidth, this.roomDepth);
                floorGeometry.rotateX(-Math.PI / 2);
                
                // Load floor texture
                const floorTexture = new THREE.TextureLoader().load(this.getTextureUrl(this.selectedMaterial));
                floorTexture.wrapS = THREE.RepeatWrapping;
                floorTexture.wrapT = THREE.RepeatWrapping;
                floorTexture.repeat.set(this.roomWidth / 2, this.roomDepth / 2); // Adjust based on tile size
                
                const floorMaterial = new THREE.MeshStandardMaterial({
                    map: floorTexture,
                    roughness: 0.2,
                    metalness: 0.1
                });
                
                this.floor = new THREE.Mesh(floorGeometry, floorMaterial);
                this.floor.receiveShadow = true;
                this.room.add(this.floor);
                
                // Create walls
                this.createWalls();
                
                // Add room to scene
                this.scene.add(this.room);
                
                // Update stats
                this.updateStats();
            }
            
            createWalls() {
                const wallThickness = 0.2;
                
                // Left wall
                const wall1Geometry = new THREE.PlaneGeometry(this.roomDepth, this.roomHeight);
                wall1Geometry.rotateY(Math.PI / 2);
                
                // Right wall
                const wall2Geometry = new THREE.PlaneGeometry(this.roomDepth, this.roomHeight);
                wall2Geometry.rotateY(-Math.PI / 2);
                
                // Back wall
                const wall3Geometry = new THREE.PlaneGeometry(this.roomWidth, this.roomHeight);
                
                // Front wall (partial)
                const wall4Geometry = new THREE.PlaneGeometry(this.roomWidth, this.roomHeight/2);
                
                // Load wall texture
                const wallTexture = new THREE.TextureLoader().load('https://www.tileshop.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/s/u/subway-white-glazed-ceramic-wall-tile.jpg');
                wallTexture.wrapS = THREE.RepeatWrapping;
                wallTexture.wrapT = THREE.RepeatWrapping;
                wallTexture.repeat.set(this.roomDepth / 2, this.roomHeight / 2); // Adjust based on tile size
                
                const wallMaterial = new THREE.MeshStandardMaterial({
                    map: wallTexture,
                    roughness: 0.3,
                    metalness: 0.05
                });
                
                // Create wall meshes
                const wall1 = new THREE.Mesh(wall1Geometry, wallMaterial.clone());
                wall1.position.set(-this.roomWidth/2, this.roomHeight/2, 0);
                wall1.receiveShadow = true;
                this.walls.push(wall1);
                
                const wall2 = new THREE.Mesh(wall2Geometry, wallMaterial.clone());
                wall2.position.set(this.roomWidth/2, this.roomHeight/2, 0);
                wall2.receiveShadow = true;
                this.walls.push(wall2);
                
                const wall3 = new THREE.Mesh(wall3Geometry, wallMaterial.clone());
                wall3.position.set(0, this.roomHeight/2, -this.roomDepth/2);
                wall3.receiveShadow = true;
                this.walls.push(wall3);
                
                const wall4 = new THREE.Mesh(wall4Geometry, wallMaterial.clone());
                wall4.position.set(0, this.roomHeight/4, this.roomDepth/2);
                wall4.receiveShadow = true;
                this.walls.push(wall4);
                
                // Add walls to room
                this.walls.forEach(wall => this.room.add(wall));
            }
            
            applyMaterial() {
                if (!this.floor) return;
                
                const textureUrl = this.getTextureUrl(this.selectedMaterial);
                const texture = new THREE.TextureLoader().load(textureUrl);
                texture.wrapS = THREE.RepeatWrapping;
                texture.wrapT = THREE.RepeatWrapping;
                texture.repeat.set(this.roomWidth / 2, this.roomDepth / 2); // Adjust based on tile size
                
                this.floor.material.map = texture;
                this.floor.material.needsUpdate = true;
                
                // In a full implementation, we would apply to selected surface (floor/wall)
            }
            
            getTextureUrl(textureId) {
                // This would be expanded with all texture options
                const textures = {
                    'floor1': 'https://www.tileshop.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/c/r/crema-marfil-porcelain-floor-tile.jpg',
                    'floor2': 'https://www.tileshop.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/s/c/screen_shot_2020-02-24_at_3.22.56_pm.png',
                    'floor3': 'https://www.tileshop.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/2/4/24-polished-carrara-white-wall-floor-tile.jpg',
                    'wall1': 'https://www.tileshop.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/s/u/subway-white-glazed-ceramic-wall-tile.jpg',
                    'wall2': 'https://www.tileshop.com/media/catalog/product/cache/1/image/9df78eab33525d08d6e5fb8d27136e95/m/e/mediterranean-blue-glazed-ceramic-wall-tile.jpg'
                };
                
                return textures[textureId] || textures['floor1'];
            }
            
            updateStats() {
                const floorArea = this.roomWidth * this.roomDepth;
                const wallArea = 2 * (this.roomWidth * this.roomHeight) + 2 * (this.roomDepth * this.roomHeight);
                const totalCost = (floorArea + wallArea) * this.tilePrice;
                
                document.getElementById('stat-floor').textContent = `${floorArea.toFixed(1)} sq.ft`;
                document.getElementById('stat-walls').textContent = `${wallArea.toFixed(1)} sq.ft`;
                document.getElementById('stat-cost').textContent = `$${totalCost.toFixed(2)}`;
            }
            
            onWindowResize() {
                this.camera.aspect = (window.innerWidth - 360) / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth - 360, window.innerHeight);
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                
                if (this.controls.enabled) {
                    this.controls.update();
                }
                
                this.renderer.render(this.scene, this.camera);
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new TileVisualizer();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional 5D Tile Visualizer</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body { 
            margin: 0; 
            font-family: 'Arial', sans-serif;
            background: #f8f9fa;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        .control-panel {
            width: 350px;
            padding: 25px;
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .visualization-container {
            flex: 1;
            position: relative;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .file-upload {
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .file-upload-input {
            position: absolute;
            font-size: 100px;
            opacity: 0;
            right: 0;
            top: 0;
        }
        .file-upload-label {
            display: block;
            padding: 10px;
            background: #f0f0f0;
            border: 1px dashed #ccc;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
        }
        .file-name {
            margin-top: 5px;
            font-size: 12px;
            color: #666;
            word-break: break-all;
        }
        button {
            background: #4a6fa5;
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #3a5a80;
        }
        .stats-panel {
            margin-top: 25px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        .stat-item {
            margin-bottom: 10px;
        }
        .stat-label {
            font-weight: 600;
            color: #555;
        }
        .stat-value {
            font-weight: 700;
            color: #333;
        }
        h2 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <h2>5D Tile Visualizer</h2>
            
            <div class="form-group">
                <label for="roomWidth">Room Width (ft)</label>
                <input type="number" id="roomWidth" value="10" min="1" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="roomDepth">Room Depth (ft)</label>
                <input type="number" id="roomDepth" value="12" min="1" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="roomHeight">Room Height (ft)</label>
                <input type="number" id="roomHeight" value="8" min="1" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="tileWidth">Tile Width (inches)</label>
                <input type="number" id="tileWidth" value="12" min="1" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="tileHeight">Tile Height (inches)</label>
                <input type="number" id="tileHeight" value="12" min="1" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="tileOrientation">Tile Orientation (degrees)</label>
                <input type="number" id="tileOrientation" value="0" min="0" max="360" step="1">
            </div>
            
            <div class="form-group">
                <label>Upload Tile Image</label>
                <div class="file-upload">
                    <input type="file" id="tileTexture" class="file-upload-input" accept="image/*">
                    <label for="tileTexture" class="file-upload-label">Choose file</label>
                    <div class="file-name" id="fileName">No file selected</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="tilePrice">Tile Price per sq.ft ($)</label>
                <input type="number" id="tilePrice" value="3.50" min="0" step="0.01">
            </div>
            
            <button id="visualizeBtn">Visualize Room</button>
            
            <div class="stats-panel">
                <h3>5D Project Details</h3>
                <div class="stat-item">
                    <span class="stat-label">Total Area:</span>
                    <span class="stat-value" id="totalArea">0 sq.ft</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Tile Count:</span>
                    <span class="stat-value" id="tileCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Material Cost:</span>
                    <span class="stat-value" id="materialCost">$0.00</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Installation Cost:</span>
                    <span class="stat-value" id="installationCost">$0.00</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Cost:</span>
                    <span class="stat-value" id="totalCost">$0.00</span>
                </div>
            </div>
        </div>
        
        <div class="visualization-container" id="visualizer">
            <div class="loading">Room visualization will appear here</div>
        </div>
    </div>

    <script>
        // Main application
        class TileVisualizer {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.room = null;
                this.floor = null;
                this.walls = [];
                this.tileTexture = null;
                this.installationRate = 4.50; // $ per sq.ft
                
                this.init();
                this.setupEventListeners();
            }
            
            init() {
                // Initialize Three.js components
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf8f9fa);
                
                // Camera
                this.camera = new THREE.PerspectiveCamera(60, (window.innerWidth - 350) / window.innerHeight, 0.1, 1000);
                this.camera.position.set(15, 15, 15);
                
                // Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth - 350, window.innerHeight);
                this.renderer.shadowMap.enabled = true;
                document.getElementById('visualizer').innerHTML = '';
                document.getElementById('visualizer').appendChild(this.renderer.domElement);
                
                // Controls
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                
                // Lighting
                this.setupLighting();
                
                // Start animation loop
                this.animate();
            }
            
            setupLighting() {
                // Ambient light
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                // Directional light
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 20, 10);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);
                
                // Hemisphere light for more natural illumination
                const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.3);
                hemisphereLight.position.set(0, 20, 0);
                this.scene.add(hemisphereLight);
            }
            
            setupEventListeners() {
                window.addEventListener('resize', () => this.onWindowResize());
                document.getElementById('visualizeBtn').addEventListener('click', () => this.visualizeRoom());
                document.getElementById('tileTexture').addEventListener('change', (e) => {
                    const fileName = e.target.files[0] ? e.target.files[0].name : 'No file selected';
                    document.getElementById('fileName').textContent = fileName;
                });
            }
            
            onWindowResize() {
                this.camera.aspect = (window.innerWidth - 350) / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth - 350, window.innerHeight);
            }
            
            animate() {
                requestAnimationFrame(() => this.animate());
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }
            
            visualizeRoom() {
                // Show loading state
                const visualizer = document.getElementById('visualizer');
                visualizer.innerHTML = '<div class="loading">Generating 5D visualization...</div>';
                
                // Clear previous room if exists
                if (this.room) {
                    this.scene.remove(this.room);
                    this.walls.forEach(wall => this.scene.remove(wall));
                    this.walls = [];
                }
                
                // Get user inputs
                const roomWidth = parseFloat(document.getElementById('roomWidth').value);
                const roomDepth = parseFloat(document.getElementById('roomDepth').value);
                const roomHeight = parseFloat(document.getElementById('roomHeight').value);
                const tileWidth = parseFloat(document.getElementById('tileWidth').value) / 12; // Convert inches to feet
                const tileHeight = parseFloat(document.getElementById('tileHeight').value) / 12; // Convert inches to feet
                const tileOrientation = parseFloat(document.getElementById('tileOrientation').value);
                const tilePrice = parseFloat(document.getElementById('tilePrice').value);
                
                // Create room container
                this.room = new THREE.Group();
                
                // Create floor
                const floorGeometry = new THREE.PlaneGeometry(roomWidth, roomDepth);
                floorGeometry.rotateX(-Math.PI / 2);
                
                // Create walls
                this.createWalls(roomWidth, roomDepth, roomHeight);
                
                // Load texture
                this.loadTexture(tileWidth, tileHeight, tileOrientation, tilePrice, roomWidth, roomDepth, roomHeight);
            }
            
            createWalls(width, depth, height) {
                const wallThickness = 0.2;
                
                // Left wall
                const wall1Geometry = new THREE.PlaneGeometry(depth, height);
                wall1Geometry.rotateY(Math.PI / 2);
                const wall1 = new THREE.Mesh(wall1Geometry, new THREE.MeshStandardMaterial({ color: 0xeeeeee }));
                wall1.position.set(-width/2, height/2, 0);
                wall1.receiveShadow = true;
                this.walls.push(wall1);
                
                // Right wall
                const wall2Geometry = new THREE.PlaneGeometry(depth, height);
                wall2Geometry.rotateY(-Math.PI / 2);
                const wall2 = new THREE.Mesh(wall2Geometry, new THREE.MeshStandardMaterial({ color: 0xeeeeee }));
                wall2.position.set(width/2, height/2, 0);
                wall2.receiveShadow = true;
                this.walls.push(wall2);
                
                // Back wall
                const wall3Geometry = new THREE.PlaneGeometry(width, height);
                const wall3 = new THREE.Mesh(wall3Geometry, new THREE.MeshStandardMaterial({ color: 0xeeeeee }));
                wall3.position.set(0, height/2, -depth/2);
                wall3.receiveShadow = true;
                this.walls.push(wall3);
                
                // Front wall (partial)
                const wall4Geometry = new THREE.PlaneGeometry(width, height/2);
                const wall4 = new THREE.Mesh(wall4Geometry, new THREE.MeshStandardMaterial({ color: 0xeeeeee }));
                wall4.position.set(0, height/4, depth/2);
                wall4.receiveShadow = true;
                this.walls.push(wall4);
            }
            
            loadTexture(tileWidth, tileHeight, orientation, tilePrice, roomWidth, roomDepth, roomHeight) {
                const fileInput = document.getElementById('tileTexture');
                const file = fileInput.files[0];
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const textureLoader = new THREE.TextureLoader();
                        textureLoader.load(event.target.result, (texture) => {
                            this.applyTextures(texture, tileWidth, tileHeight, orientation, tilePrice, roomWidth, roomDepth, roomHeight);
                        });
                    };
                    reader.readAsDataURL(file);
                } else {
                    // Use default texture
                    const textureLoader = new THREE.TextureLoader();
                    textureLoader.load('https://threejs.org/examples/textures/brick_diffuse.jpg', (texture) => {
                        this.applyTextures(texture, tileWidth, tileHeight, orientation, tilePrice, roomWidth, roomDepth, roomHeight);
                    });
                }
            }
            
            applyTextures(texture, tileWidth, tileHeight, orientation, tilePrice, roomWidth, roomDepth, roomHeight) {
                // Configure texture
                texture.wrapS = THREE.RepeatWrapping;
                texture.wrapT = THREE.RepeatWrapping;
                
                // Calculate repeat counts
                const floorRepeatX = roomWidth / tileWidth;
                const floorRepeatY = roomDepth / tileHeight;
                
                // Create floor material with texture
                const floorMaterial = new THREE.MeshStandardMaterial({ 
                    map: texture.clone(),
                    roughness: 0.2,
                    metalness: 0.1
                });
                floorMaterial.map.repeat.set(floorRepeatX, floorRepeatY);
                
                // Create floor
                const floorGeometry = new THREE.PlaneGeometry(roomWidth, roomDepth);
                floorGeometry.rotateX(-Math.PI / 2);
                this.floor = new THREE.Mesh(floorGeometry, floorMaterial);
                this.floor.receiveShadow = true;
                this.floor.rotation.y = THREE.MathUtils.degToRad(orientation);
                this.room.add(this.floor);
                
                // Apply texture to walls
                const wallRepeatX = roomDepth / tileWidth;
                const wallRepeatY = roomHeight / tileHeight;
                
                this.walls.forEach((wall, index) => {
                    const wallMaterial = new THREE.MeshStandardMaterial({
                        map: texture.clone(),
                        roughness: 0.3,
                        metalness: 0.05
                    });
                    
                    // Adjust repeat for different walls
                    if (index < 2) { // Side walls
                        wallMaterial.map.repeat.set(wallRepeatX, wallRepeatY);
                    } else { // Front/back walls
                        wallMaterial.map.repeat.set(roomWidth / tileWidth, roomHeight / tileHeight);
                    }
                    
                    wall.material = wallMaterial;
                    wall.material.needsUpdate = true;
                    this.room.add(wall);
                });
                
                // Add room to scene
                this.scene.add(this.room);
                
                // Calculate and display 5D statistics
                this.calculateStatistics(tileWidth, tileHeight, tilePrice, roomWidth, roomDepth, roomHeight);
                
                // Reset camera position
                this.camera.position.set(roomWidth, roomHeight * 1.5, roomDepth);
                this.controls.target.set(0, roomHeight/2, 0);
            }
            
            calculateStatistics(tileWidth, tileHeight, tilePrice, roomWidth, roomDepth, roomHeight) {
                // Floor area
                const floorArea = roomWidth * roomDepth;
                const floorTiles = Math.ceil(roomWidth / tileWidth) * Math.ceil(roomDepth / tileHeight);
                
                // Wall area (all four walls)
                const wallArea = 2 * (roomWidth * roomHeight) + 2 * (roomDepth * roomHeight);
                const wallTiles = 2 * Math.ceil(roomWidth / tileWidth) * Math.ceil(roomHeight / tileHeight) + 
                                  2 * Math.ceil(roomDepth / tileWidth) * Math.ceil(roomHeight / tileHeight);
                
                // Totals
                const totalArea = floorArea + wallArea;
                const totalTiles = floorTiles + wallTiles;
                const materialCost = totalArea * tilePrice;
                const installationCost = totalArea * this.installationRate;
                const totalCost = materialCost + installationCost;
                
                // Update UI
                document.getElementById('totalArea').textContent = `${totalArea.toFixed(2)} sq.ft`;
                document.getElementById('tileCount').textContent = totalTiles;
                document.getElementById('materialCost').textContent = `$${materialCost.toFixed(2)}`;
                document.getElementById('installationCost').textContent = `$${installationCost.toFixed(2)}`;
                document.getElementById('totalCost').textContent = `$${totalCost.toFixed(2)}`;
            }
        }
        
        // Initialize the visualizer when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new TileVisualizer();
        });
    </script>
</body>
</html>
